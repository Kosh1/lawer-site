# Система промптов для разных типов лендингов

## Обзор

Система позволяет использовать специализированные промпты для разных типов семейных споров, что повышает качество и релевантность ответов ИИ.

## Структура

### Базовый промпт (`BASE_LAWYER_PROMPT`)
Используется для дефолтного лендинга с новой логикой:
- Структура работы
- Общие правила общения
- Правила составления черновика
- Обязательные пункты искового заявления
- **Предложение подборки похожих дел за 100 рублей**
- **Ссылка на оплату: https://www.aiisk.ru/pay**
- **Возможность продолжить без подборки**

### Старый формат промпта (`OLD_LAWYER_PROMPT`)
Используется для всех специализированных лендингов:
- Полный оригинальный промпт
- Все правила и инструкции
- Часто задаваемые вопросы
- Структура искового заявления
- Предложение звонка юристу

## Использование

### В API (`/api/chat`)

```typescript
// Получение промпта в зависимости от типа лендинга
const lawyerPrompt = getLawyerPrompt(landingType);

// Использование в OpenAI запросе
const formattedMessages = [
  { role: "system", content: lawyerPrompt },
  ...messages
];
```

### В компонентах

```typescript
// Передача типа лендинга в ChatDialog
<ChatDialog
  isOpen={isChatOpen}
  onClose={() => setIsChatOpen(false)}
  initialMessage={situation}
  utm={utm}
  landingType={landingType}
/>
```

### Определение типа лендинга

1. **Прямая передача**: `landingType` параметр в API запросе
2. **UTM параметры**: `utm.landing_type` или анализ `utm.utm_source`
3. **URL параметры**: из `?landing=no-contact`

## Типы лендингов

| Тип | Описание | URL | Формат промпта |
|-----|----------|-----|----------------|
| `no-contact` | Порядок общения с ребёнком | `/no-contact` | Старый |
| `deprive-rights` | Лишение родительских прав | `/deprive-rights` | Старый |
| `increase-alimony` | Увеличение алиментов | `/increase-alimony` | Старый |
| `divorce` | Расторжение брака | `/divorce` | Старый |
| `property-split` | Раздел имущества | `/property-split` | Старый |
| `default` | Общие семейные споры | `/` | Новый |

## Преимущества

1. **Совместимость**: Старый формат сохранен для всех специализированных лендингов
2. **Инновация**: Новый формат для дефолтного лендинга с улучшенной структурой
3. **Монетизация**: Предложение подборки похожих дел за 100 рублей
4. **Безопасность**: Постепенное внедрение изменений без риска
5. **Гибкость**: Возможность тестировать новый формат на одном лендинге

## Новая функциональность (дефолтный лендинг)

### Подборка похожих дел
Вместо предложения звонка юристу, бот предлагает:
- **Подборку реальных дел** с похожими ситуациями
- **Анализ 5-7 выигрышных дел**
- **Ключевые аргументы**, которые привели к победе
- **Список необходимых доказательств**
- **Советы по ведению дела**

### Оплата и доступ
- **Стоимость**: 100 рублей
- **Ссылка для оплаты**: https://www.aiisk.ru/pay
- **Добровольность**: пользователь может продолжить без подборки
- **Автоматическое составление иска** в любом случае

## Логика выбора промпта

### Старый формат (для специализированных лендингов)
- `no-contact`
- `deprive-rights`
- `increase-alimony`
- `divorce`
- `property-split`

### Базовый промпт (для дефолтного лендинга)
- `default` (или любой другой тип)

## Добавление нового типа спора

1. Добавить конфигурацию в `lib/landingConfigs.ts`
2. Добавить роут в `vercel.json`
3. Определить, какой формат промпта использовать:
   - Для специализированного лендинга → автоматически будет использован старый формат
   - Для дефолтного лендинга → автоматически будет использован базовый промпт с новой логикой

## Пример добавления нового типа

```typescript
// В lib/landingConfigs.ts
export const newDisputeConfig: LandingConfig & { exampleImagesDir?: string } = {
  title: "Новый тип спора",
  subtitle: "Описание нового типа спора",
  // ... остальные поля
};

// В vercel.json
{
  "rewrites": [
    { "source": "/new-dispute", "destination": "/?landing=new-dispute" }
  ]
}

// Автоматически будет использован старый формат промпта
```
